{% extends "base.html" %}
{% load wagtailcore_tags wagtailimages_tags %}

{% block content %}
  <section class="section">
    <div class="container-shell">
      <header class="max-w-3xl">
        <h1 class="text-3xl md:text-5xl leading-[1.05]">{{ page.title }}</h1>
        {% if page.intro %}
          <div class="mt-6 prose max-w-none">
            {{ page.intro|richtext }}
          </div>
        {% endif %}
      </header>

      {% if page.get_children.live %}
        <div class="mt-12 columns-1 md:columns-2 lg:columns-3 gap-4 [column-fill:_balance]">
          {% for child in page.get_children.live %}
            {% with item=child.specific %}
              <div class="break-inside-avoid mb-4">
                <details class="card p-5 group" data-accordion>
                  <summary class="cursor-pointer list-none flex items-start justify-between gap-4">
                    <div>
                      <div class="text-lg">{{ item.title }}</div>
                      {% if item.intro %}
                        <div class="mt-2 text-sm text-muted line-clamp-3">
                          {{ item.intro|striptags }}
                        </div>
                      {% endif %}
                    </div>
                    <span class="text-muted group-open:rotate-45 transition">+</span>
                  </summary>

                  <div class="mt-5">
                    <div class="flex gap-3">
                      <a class="btn-secondary" href="{% pageurl item %}">View</a>
                    </div>

                    {% with subs=item.get_subsections offerings=item.get_offerings %}
                      {% if subs %}
                        <div class="mt-6">
                          <div class="text-sm text-muted mb-3">Subcategories</div>
                          <div class="flex gap-3 overflow-x-auto scroll-smooth snap-x snap-mandatory pb-2">
                            {% for s in subs %}
                              <a class="card p-4 min-w-[240px] snap-start no-underline" href="{% pageurl s %}">
                                <div class="text-base">{{ s.title }}</div>
                                {% if s.intro %}
                                  <div class="mt-2 text-sm text-muted line-clamp-2">{{ s.intro|striptags }}</div>
                                {% endif %}
                              </a>
                            {% endfor %}
                          </div>
                        </div>
                      {% endif %}

                      {% if offerings %}
                        <div class="mt-6">
                          <div class="text-sm text-muted mb-3">Offerings</div>
                          <div class="flex gap-3 overflow-x-auto scroll-smooth snap-x snap-mandatory pb-2">
                            {% for t in offerings %}
                              <a class="card p-4 min-w-[260px] snap-start no-underline" href="{% pageurl t %}">
                                {% if t.featured_image %}
                                  {% image t.featured_image fill-900x650 as img %}
                                  <img class="w-full rounded-2xl object-cover aspect-[4/3] border border-border/30" src="{{ img.url }}" alt="{{ img.alt|default:t.title }}" />
                                {% else %}
                                  <div class="w-full rounded-2xl bg-surface-2 border border-border/30 aspect-[4/3]"></div>
                                {% endif %}
                                <div class="mt-3 text-base">{{ t.title }}</div>
                                {% if t.summary %}<div class="mt-2 text-sm text-muted line-clamp-2">{{ t.summary }}</div>{% endif %}
                              </a>
                            {% endfor %}
                          </div>
                        </div>
                      {% endif %}
                    {% endwith %}
                  </div>
                </details>
              </div>
            {% endwith %}
          {% endfor %}
        </div>
      {% endif %}
    </div>
  </section>

  {% if page.sections %}
    {% for block in page.sections %}
      {% include_block block %}
    {% endfor %}
  {% endif %}
{% endblock %}
